<div class="page_header_container">
    <div class="page_header">
        <div class="left page_action_container">
            <a ui-sref="organizations" class="page_action"><i class="fa fa-chevron-left"></i> Organizations</a>
        </div>
        <div class="page_title">
            <h1>{$ org.name $}</h1>
        </div>
        <div class="right page_action_container"></div>
    </div>
</div>
<div class="section_nav_container">
    <div class="section_nav" ng-include="urls.static_url + 'seed/partials/accounts_nav.html'"></div>
</div>
<div class="section">
    <div class="section_header_container">
        <div class="section_header has_no_padding fixed_height_short">
            <div class="section_action_container left_40">
                <h2><i class="fa fa-flag"></i> Data Quality</h2>
            </div>
            <div class="section_action_container right_40 section_action_btn pull-right">
                <button type="button" class="btn btn-default" ng-click="restore_defaults()">Restore Default Rules
                    <i class="fa fa-check" ng-show="defaults_restored"></i>
                </button>
                <button type="button" class="btn btn-default" ng-click="reset_all_rules()">Reset All Rules
                    <i class="fa fa-check" ng-show="rules_reset"></i>
                </button>
                <button type="button" class="btn btn-primary" ng-click="save_settings()">Save Changes
                    <i class="fa fa-check" ng-show="rules_updated"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="section_content_container">
        <div class="section_content with_padding" ng-if="org.is_parent && auth.requires_owner" style="margin-bottom:15px;">
            <h3>In-Range Checking: Modifying Data Quality Rules</h3>
            <p>From the table below, select the rules that you want to: 1) enable/disable within your organization, and 2) modify the minimum/maximum values to validate against on file upload.</p>
            <div class="right_wide section_action_container"><a ng-click="create_new_rule()">Create a new rule</a></div>
            <div class="data-quality-tab-container">
                <ul class="nav nav-tabs" style="margin-bottom:1px;">
                    <li ui-sref-active="active" heading="View by Property">
                        <a ui-sref="organization_data_quality({organization_id: org.id, inventory_type: 'properties'})">View by Property</a>
                    </li>
                    <li ui-sref-active="active" heading="View by Tax Lot">
                        <a ui-sref="organization_data_quality({organization_id: org.id, inventory_type: 'taxlots'})">View by Tax Lot</a>
                    </li>
                </ul>
            </div>
            <div class="table_list_container has_borders">
                <table id="data-quality-admin-table" class="table has_no_btm_margin tbody-striped">
                    <thead>
                        <tr>
                            <th class="condensed_head" style="min-width: 33px; width: 33px;"></th>
                            <th>Field</th>
                            <th style="min-width: 100px;">Field Type</th>
                            <th style="width: 70px;">Required</th>
                            <th style="width: 70px;">Not Null</th>
                            <th>Minimum</th>
                            <th>Maximum</th>
                            <th style="min-width: 100px;">Severity</th>
                            <th>Units</th>
                            <th>Label</th>
                            <th class="condensed_head" style="min-width: 33px; width: 33px;"></th>
                        </tr>
                    </thead>
                    <tbody ng-repeat="ruleGroup in ruleGroups[inventory_type]">
                        <tr ng-repeat="rule in ruleGroup" ng-if="!rule.delete" ng-class="{ 'warning' : rule.new, 'disabled' : !rule.enabled }">
                            <td class="check is_aligned_center" style="width: 33px;" ng-click="rule.enabled = !rule.enabled">
                                <input type="checkbox" ng-model="rule.enabled" class="no-click">
                            </td>
                            <td>
                                <select class="form-control input-sm" ng-model="rule.field" ng-options="col.name as col.displayName for col in all_columns.fields" ng-change="change_field(rule, '{$ rule.field $}', $index)" title="{$ rule.field $}" focus-if="{$ rule.autofocus || 'false' $}"></select>
                            </td>
                            <td>
                                <select class="form-control input-sm" ng-model="rule.type" ng-options="type.id as type.label for type in field_types" ng-change="change_type(rule, $index)"></select>
                            </td>
                            <td ng-click="change_required(rule)" class="text-center">
                                <input type="checkbox" ng-model="rule.required" class="no-click">
                            </td>
                            <td ng-click="change_not_null(rule)" class="text-center">
                                <input type="checkbox" ng-model="rule.not_null" class="no-click">
                            </td>
                            <td ng-attr-colspan="{$ rule.type == 'string' && '2' || '1' $}">
                                <input class="form-control input-sm" type="number" ng-model="rule.min" ng-if="_.includes([null, 'number', 'year'], rule.type)" placeholder="(no minimum)">
                                <input class="form-control input-sm" type="text" ng-model="rule.min" ng-if="rule.type == 'string'" placeholder="(no text match)">
                                <input class="form-control input-sm" type="date" ng-model="rule.min" ng-if="rule.type == 'date'">
                            </td>
                            <td ng-if="rule.type != 'string'">
                                <input class="form-control input-sm" type="number" ng-model="rule.max" ng-if="rule.type != 'date'" placeholder="(no maximum)">
                                <input class="form-control input-sm" type="date" ng-model="rule.max" ng-if="rule.type == 'date'">
                            </td>
                            <td>
                                <select class="form-control input-sm" ng-model="rule.severity" ng-class="{'error-bg': rule.severity=='error', 'warning-bg': rule.severity=='warning'}">
                                    <option value="error">Error</option>
                                    <option value="warning">Warning</option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control input-sm" ng-options="u for u in units" ng-model="rule.units"></select>
                            </td>
                            <td>
                                <input class="form-control input-sm" ng-model="rule.label" ng-if="rule.new">
                                <select class="form-control input-sm" ng-model="rule.label" ng-options="label.id as label.name for label in all_labels" ng-if="!rule.new"> </select>
                            </td>
                            <td class="check is_aligned_center" style="width: 33px;">
                                <button class="btn btn-danger btn-rowform" ng-click="delete_rule(rule, $index)">X</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="section_content_container">
            <div class="section_content with_padding pull-right" style="padding-bottom: 15px;">
                <button type="button" class="btn btn-default" ng-click="restore_defaults()">Restore Default Rules
                    <i class="fa fa-check" ng-show="defaults_restored"></i>
                </button>
                <button type="button" class="btn btn-default" ng-click="reset_all_rules()">Reset All Rules
                    <i class="fa fa-check" ng-show="rules_reset"></i>
                </button>
                <button type="button" class="btn btn-primary" ng-click="save_settings()">Save Changes
                    <i class="fa fa-check" ng-show="rules_updated"></i>
                </button>
            </div>
        </div>
    </div>
</div>
