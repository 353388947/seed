<div class="page_header_container" ng-cloak>
    <div class="page_header">
        <div class="left page_action_container">
            <a ng-if="item_type==='property'"
               ui-sref="properties"
               class="page_action">
                <i class="fa fa-chevron-left"></i> Properties
            </a>
            <a ng-if="item_type==='taxlot'"
               ui-sref="taxlots"
               class="page_action">
                <i class="fa fa-chevron-left"></i> Tax Lots
            </a>
        </div>

    </div>
</div>
<div class="section_nav_container">
    <div class="section_nav">

        <a id="item_title"
           ng-if="item_type==='property'"
           ng-href="#/properties/{$ property.id $}"
           class="active">
            Property Info
        </a>
        <a id="item_title"
           ng-if="item_type==='taxlot'"
           ng-href="#/taxlots/{$ taxlot.id $}"
           class="active">
            Tax Lot Info
        </a>

        <a id="settings"
           ng-if="item_type==='property'"
           ng-href="#/properties/detail_settings">
            Settings
        </a>
        <a id="settings"
           ng-if="item_type==='taxlot'"
           ng-href="#/taxlots/detail_settings">
            Settings
        </a>

    </div>
</div>
<div class="section">
    <div class="section_header_container">
        <div class="section_header fixed_height_short has_no_padding">
            <div class="section_action_container left">
                <span>
                    <h2>
                        <i ng-if="item_type==='property'" class="fa fa-building-o"></i>
                        <i ng-if="item_type==='taxlot'" class="fa fa-map-o"></i>
                        {$ item_title $}
                    </h2>
                </span>
            </div>
            <div class="section_action_container right"
                 ng-hide="edit_form_showing">
                <a ng-click="on_edit()"
                   ng-show="user_role !== 'viewer'">
                    <i class="fa fa-pencil"></i> Edit
                </a>
            </div>
            <div class="section_action_container right section_action_btn"
                 ng-show="edit_form_showing">
                <a roll="button"
                   class="btn btn-default btn-sm"
                   ng-click="on_cancel()">
                    Cancel
                </a>
                <a roll="button"
                   class="btn btn-primary btn-sm"
                   ng-click="on_save()">
                    Save Changes
                </a>
            </div>
        </div>
    </div>
    <div class="section_content_container">
        <div class="section_content">

             <div style="float:right; width:330px; text-align:right; margin: 10px 10px 0px 0px;" class="ellipsis">
                 <span style="color:#777"
                       popover-placement="top-left"
                       popover-animation="false"
                       popover-trigger="outsideClick"
                       uib-popover="{$  cycle.name $}">
                     Cycle: {$ cycle.name $}
                 </span>
            </div>

            <div style="margin:10px 350px 10px 0px; padding:0px 10px;">
                <button type="button"
                        class="btn btn-default"
                        ng-click="open_update_labels_modal()">
                    <i class="fa fa-tag"></i>Add/Remove Labels
                </button>
                <span style="padding:0px 0px 0px 15px;"><strong>Labels:</strong></span>
                <span ng-show="labels.length === 0" style="color:#999">(no labels applied)</span>
                <span ng-repeat="label in labels" class="label label-{$ label.label $}">{$ label.name $}</span>
            </div>

            <div class="table_list_container table_item_detail">
                <table class="table table-striped table_highlight_first fixed-layout">
                    <thead>
                        <tr>
                            <th sd-resizable
                                id="building-fields">
                                Field
                            </th>
                            <th sd-resizable
                                class="ellipsis-resizable">
                                Current Value
                            </th>
                            <!-- Historical values -->
                            <th ng-repeat ="historical_item in historical_items"
                                class="ellipsis">
                                <div ng-if="historical_item.source=='ImportFile'"
                                     uib-popover="{$ historical_item.filename $}">
                                    {$ historical_item.filename $}
                                </div>
                                <div ng-if="historical_item.source=='UserEdit'">
                                    (User Edit)
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>

                        <tr ng-repeat="field in data_fields">

                            <!-- Field name -->
                            <td>{$ field.key | titleCase $}</td>

                            <!-- Show read-only current 'regular' field value -->
                            <td ng-if="edit_form_showing===false && field.type !== 'extra_data'"
                                ng-class="changed_fields.regular_fields.indexOf(field.key)>=0 ? 'highlight' : ''"
                                class="ellipsis">
                                    <span  class="sd-data-content"
                                           popover-placement="top-left"
                                           popover-animation="false"
                                           popover-trigger="outsideClick"
                                           uib-popover="{$ item_state[field.key] $}">
                                        {$ item_state[field.key] $}
                                    </span>
                            </td>

                            <!-- Show read-only current 'extra_data' field value -->
                            <td ng-if="edit_form_showing===false && field.type === 'extra_data'"
                                ng-class="changed_fields.extra_data_fields.indexOf(field.key)>=0 ? 'highlight' : ''"
                                class="ellipsis">
                                <span  class="sd-data-content"
                                       popover-placement="top-left"
                                       popover-animation="false"
                                       popover-trigger="outsideClick"
                                       uib-popover="{$ item_state.extra_data[field.key] $}">
                                    {$ item_state.extra_data[field.key]  $}
                                </span>
                            </td>

                            <!-- Show input form to edit current field value -->
                            <td ng-if="edit_form_showing"
                                ng-class=" (field.type !== 'extra_data' && changed_fields.extra_data_fields.indexOf(field.key)>=0) || changed_fields.regular_fields.indexOf(field.key)>=0 ? 'highlight' : ''"
                            >
                                <div ng-if="current_state_field.type !== 'extra_data'">
                                    <input id="edit_attribute_id"
                                           class="form-control input-sm"
                                           type="text"
                                           name="tax_lot_id"
                                           ng-model="item_state[field.key]"/>
                                </div>
                                <div ng-if="current_state_field.type === 'extra_data'">
                                    <input id="edit_property_attribute_id"
                                           class="form-control input-sm"
                                           type="text"
                                           name="tax_lot_id"
                                           ng-model="item_state.extra_data[field.key]"/>
                                </div>
                            </td>

                            <!-- Show read-only historical field value -->
                            <td ng-repeat="historical_item in historical_items"
                                ng-class=" (field.type !== 'extra_data' && historical_item.changed_fields.extra_data_fields.indexOf(field.key)>=0) || historical_item.changed_fields.regular_fields.indexOf(field.key)>=0 ? 'highlight' : ''"
                                class="ellipsis"
                                >
                                <span  ng-if="field.type !== 'extra_data'"
                                       class="sd-data-content"
                                       popover-placement="top-left"
                                       popover-trigger="outsideClick"
                                       popover-animation="false"
                                       uib-popover="{$ historical_item.state[field.key] $}">
                                    {$ historical_item.state[field.key] $}
                                </span>
                                 <span  ng-if="field.type === 'extra_data'"
                                        class="sd-data-content"
                                        popover-placement="top-left"
                                        popover-trigger="outsideClick"
                                        popover-animation="false"
                                        uib-popover="{$ historical_item.state.extra_data[field.key]  $}">
                                    {$ historical_item.state.extra_data[field.key] $}
                                </span>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Related Items Section -->
<div class="section">
    <div class="section_header_container" style="margin-top: 20px; border-bottom: 0px;">
        <div class="section_header fixed_height_short has_no_padding">
            <div class="section_action_container left">
                <span>
                    <h2 ng-if="item_type==='taxlot'">
                        <i class="fa fa-building-o"></i> Related Properties
                    </h2>
                    <h2 ng-if="item_type==='property'">
                        <i class="fa fa-map-o"></i> Related Tax Lots
                    </h2>
                </div>
            </div>
        </div>
    </div>

    <div class="section_content_container" style="margin-bottom:200px;">
        <!-- List of related Tax Lots -->
        <div ng-if="item_type==='property'" class="section_content" >
            <div class="table_list_container table_item_detail" style="max-width: 700px;">
                 <table class="table table-striped table_highlight_first fixed-layout">
                    <thead>
                        <tr>
                            <th sd-resizable
                                width="80">
                                ID
                            </th>
                            <th sd-resizable
                                class="ellipsis-resizable">
                                Address Line 1
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="taxlot in related_taxlots">
                            <td> {$ taxlot.taxlot.id $}</td>
                            <td>
                                <a ng-click="on_show_related_taxlot(taxlot)">
                                    {$ (taxlot.state.address_line_1) ? taxlot.state.address_line_1 : '(no address 1)'$}
                                </a>
                            </td>
                        </tr>
                    </tbody>
                 </table>
            </div>
        </div>

        <!-- List of related Properties -->
       <div ng-if="item_type==='taxlot'" class="section_content" >
            <div class="table_list_container table_item_detail" style="max-width: 700px;">
                 <table class="table table-striped table_highlight_first fixed-layout">
                    <thead>
                        <tr>
                            <th sd-resizable
                                width="80">
                                ID
                            </th>
                            <th sd-resizable
                                class="ellipsis-resizable">
                                Address Line 1
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="property in related_properties">
                            <td> {$ property.property.id $}</td>
                            <td>
                                <a ng-click="on_show_related_property(property)">
                                    {$ (property.state.address_line_1) ? property.state.address_line_1 : '(no address 1)' $}
                                </a>
                            </td>
                        </tr>
                    </tbody>
                 </table>
            </div>
        </div>

    </div>

</div>
